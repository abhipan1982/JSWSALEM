@using PE.HMIWWW.Core.Resources;
@using PE.HMIWWW.Core.Extensions;
@using PE.HMIWWW.Areas.AlarmManagement.ViewModels;
@model long

<script>

  function assignRole(isAssigned, roleId, alarmDefinitionToRoleId)
  {
    if(isAssigned) {
      let url = 'AlarmCreator/UnassignAlarmFromRole';
        sendConfirmedRequest(Translations["MESSAGE_ConfirmationMsg"], '', () => {
          sendRequest(url, { alarmDefinitionToRoleId: alarmDefinitionToRoleId }, refreshAlarmRolesGrid);
      });
    } else {
        let url = 'AlarmCreator/AssignAlarmToRole';
        sendConfirmedRequest(Translations["MESSAGE_ConfirmationMsg"], '', () => {
          sendRequest(url, { roleId: roleId, alarmDefinitionId: @Model }, refreshAlarmRolesGrid);
      });
    }
  }
</script>

@(Html.Kendo().Grid<VM_AlarmRole>()
    .Name("AlarmRolesGrid")
    .NoRecords(n => n.Template(VM_Resources.GLOB_GRID_NO_DATA))
    .Sortable()
    .Filterable()
    .Pageable(p => p
    .Messages(m => m.Display(VM_Resources.GLOB_pagination)))
    .HtmlAttributes(new { style = "height: 640px;" })
    .Columns(columns =>
    {
        columns.Bound(p => p.AlarmDefinitionId).Visible(false);
        columns.Bound(p => p.Id).Visible(false);
        columns.Bound(p => p.AlarmDefinitionToRoleId).Visible(false);
        columns.Bound(p => p.Name);
        columns.Bound(x => x.IsAssigned)
         .ClientTemplate("<input type='checkbox' #= IsAssigned ? 'checked=checked' : '' # onClick='assignRole(#=IsAssigned#, \"#:Id#\", #=AlarmDefinitionToRoleId#)'></input>");
    })
  .DataSource(d => d
    .Ajax()
    .ServerOperation(true)
    .PageSize(23)
    .Read(r => r.Action("GetRoles", "AlarmCreator", new { Area = "AlarmManagement", alarmDefinitionId = Model }))
  )
)

@*#=IsAssigned#, #=Id#, #=AlarmDefinitionToRoleId#*@
