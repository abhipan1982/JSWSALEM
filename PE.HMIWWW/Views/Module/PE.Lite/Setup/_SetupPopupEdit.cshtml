@model PE.HMIWWW.ViewModel.Module.Lite.Setup.VM_ListOfFilters
@{
    ViewBag.Title = "_SetupPopupEdit";
    Layout = "~/Views/Shared/_PopupLayout.cshtml";
}

<form asp-controller="Setup" asp-action="UpdateSetupParameters" data-ajax="true" data-ajax-method="POST"
      data-ajax-begin="OnFormBegin" data-ajax-success="OnFormSuccess" data-ajax-failure="OnFormError"
      class="container-fluid" target="formContainer" role="form" id="form">

    @Html.HiddenFor(x => x.SetupId)
    <div style="height:auto;overflow-x:hidden">
        <div class="row form-group">
            <div class="col-4 text-right">
                @Html.LabelFor(x => x.SetupTypeCode)
            </div>
            <div class="col">
                @Html.Kendo().TextBoxFor(x => x.SetupTypeCode).HtmlAttributes(new { style = "width:100%" }).Enable(false)
            </div>
        </div>
        <div class="row form-group">
            <div class="col-4 text-right">
                @Html.LabelFor(x => x.SetupName)
            </div>
            <div class="col">
                @Html.Kendo().TextBoxFor(x => x.SetupName).HtmlAttributes(new { style = "width:100%" }).Enable(false)
            </div>
        </div>


        @for (int i = 0; i < Model.ListOfFilters.Count; i++)
        {
            @Html.HiddenFor(x => x.ListOfFilters[i].SetupParameterId)
            @Html.HiddenFor(x => x.ListOfFilters[i].SetupType)
            @Html.HiddenFor(x => x.ListOfFilters[i].ParameterType)

            <div class="row form-group">
                <div class="col-4 text-right">
                    <label>@Model.ListOfFilters[i].ParameterNameTranslated</label>
                </div>
                <div class="col">

                    @(Html.Kendo().DropDownListFor(x => @Model.ListOfFilters[i].ParameterValue)
                    .DataTextField("Value")
                    .DataValueField("Key")
                    .NoDataTemplate(VM_Resources.GLOB_GRID_NO_DATA)
                    .Value(@Model.ListOfFilters[i].ParameterValue.ToString())
                    .OptionLabel("-")
                    .Filter("contains")
                    .HtmlAttributes(new { style = "width:100%", Name = ($"ListOfFilters[{i}].ParameterValue") })
                    .DataSource(source =>
                    {
                      source.Read(read =>
                      {
                        read.Action("GetFilteringData", "Setup", new { tableName = @Model.ListOfFilters[i].TableName, columnId = @Model.ListOfFilters[i].ColumnId, columnName = @Model.ListOfFilters[i].ColumnValue });
                      })
                      .ServerFiltering(false);
                    }))
                    @if (@Model.ListOfFilters[i].IsRequierd)
                    {
                        <script>
                              $(document).ready(function () {
                                $('#ListOfFilters_'+@i+'__ParameterValue').attr("required", true);
                              })
                        </script>
                    }

                </div>
            </div>

        }
    </div>
    <hr>

    <div class="row form-group">
        <div class="col invalid">
            <p id="error">
                <span class="k-icon k-i-close-circle error-icon"></span> @VM_Resources.GLOB_Error
            </p>
        </div>
        <div class="col text-right">
            <button class="btn btn-primary popup_button" onclick="displayMessage()" type="submit">
                @VM_Resources.GLOB_Form_Button_Save
            </button>
        </div>
    </div>
</form>

<script>


    $(function () {

        $('#error').css("display", "none");
        $("#form").kendoValidator({ messages: { required: Translations["FORM_ATTRIBUTE_FieldIsRequired"] } }).data("message");

    });

    function displayMessage() {

        var validator = $("#form").kendoValidator({ messages: { required: Translations["FORM_ATTRIBUTE_FieldIsRequired"] } }).data("message");

        if (validator.validate()) {
            $('#error').css("display", "none");
        } else {
            $('#error').css("display", "block");
            $('#popup-footer')
                .css('display', 'block')
                .css('background-color', 'rgb(206, 0, 55)');
        }
    };

</script>

