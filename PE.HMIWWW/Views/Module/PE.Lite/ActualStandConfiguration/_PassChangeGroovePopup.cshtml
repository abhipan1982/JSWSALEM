@using PE.BaseDbEntity.EnumClasses;
@model PE.HMIWWW.ViewModel.Module.Lite.RollsetDisplay.VM_RollsetDisplay
@{
  Layout = "~/Views/Shared/_PopupLayout.cshtml";
}

<style>
  .h_dotted_ln {
      border-bottom: 1px dashed black;
      width: 100%;
  }

  .h_dotted_right_ln {
      border-right: 1px solid rgba(0,0,0,.1);
  }

  .h_blank_ln {
      width: 100%;
      height: 20px;
  }

  .v_blank_ln {
      width: 20px;
  }

  .table-roll-details label {
      font-weight: bold;
      font-style: normal;
  }

  .table-roll-details td {
      font-weight: normal;
      font-style: italic;
  }

  .horizontal-scroll-except-first-column {
      width: 100%;
      overflow: auto;
      padding-bottom: 10px;
  }

      .horizontal-scroll-except-first-column > table {
          margin-left: 200px;
      }

          .horizontal-scroll-except-first-column > table > * > tr > th:first-child,
          .horizontal-scroll-except-first-column > table > * > tr > td:first-child {
              position: absolute;
              width: 200px;
              margin-left: -200px;
              background: white;
              z-index: 100;
          }

          .horizontal-scroll-except-first-column > table > * > tr > th:first-child {
              height: 3.7rem;
          }

  .last-desc {
      height: 3.2rem !important;
  }

  .horizontal-scroll-except-first-column > table > * > tr > th,
  .horizontal-scroll-except-first-column > table > * > tr > td {
      /* Without this, if a cell wraps onto two lines, the first column
                            * will look bad, and may need padding.
                                 white-space: nowrap; */
  }
</style>

<script>

  function onLimitValueChange(e) {
    var limit = parseInt($(this.element).attr("data-limit")) || 0;

    if (this.value() > limit) {
        this.element.css('background-color', 'lightpink');
        this.element.prev().css('background-color', 'lightpink');
    }
    else {
        this.element.css('background-color', 'white');
        this.element.prev().css('background-color', 'white');
    }
    }

  $(document).ready(function () {
    $('input:checkbox:not(.disabled)').on('click', function () {
      $('input:checkbox').prop('checked', false);
      $('input:checkbox').removeClass('disabled');

      $(this).prop('checked', true);
      $(this).addClass('disabled');
    })
  @Html.Kendo().DeferredScripts(false);
  })

</script>

<form asp-controller="ActualStandConfiguration" asp-action="ConfigRollSetSubmit" data-ajax="true" data-ajax-method="POST"
      data-ajax-begin="OnFormBegin" data-ajax-success="OnFormSuccess" data-ajax-failure="OnFormError"
      class="container-fluid" target="formContainer" role="form" id="form">
  @Html.AntiForgeryToken()
  @Html.HiddenFor(model => model.RollSetId)
  @Html.HiddenFor(m => m.UpperRollId)
  @Html.HiddenFor(m => m.BottomRollId)
  @{

    int limit = Model.GrooveActualRollUpper.Count();
  }
  @for (int i = 0; i < Model.GrooveActualRollUpper.Count(); i++)
  {
    int j = i;
    @Html.HiddenFor(m => m.GrooveActualRollUpper[j].GrooveTemplateId)
    ;
  }

  <style>
    .scale {
        transform: scale(1);
    }

    .roll {
        position: relative;
    }

    .number {
        position: absolute;
        left: 50%;
        top: 50%;
        font-size: 24px;
        color: #000;
        transform: translate(-50%,-50%);
        opacity: 0.8;
        z-index: 1;
    }

    div.popupContainer > .container {
        overflow-y: hidden !important;
    }

    .header-row {
        position: relative;
        height: 22px;
    }

    .header-data {
        position: absolute;
        margin-left: 2px;
    }

    th label {
        color: #00587c;
        font-weight: 500;
        font-size: 14px;
    }

    .section {
        color: #6d8292;
        font-weight: 500;
        font-size: 14px;
    }
  </style>

  <div class="horizontal-scroll-except-first-column">
    <table id="content-div">
      <tbody>
        @* ROLL BEGIN*@
        <tr>
          <th class="section">@VM_Resources.NAME_RollName</th>
          <td colspan="@(limit)"><hr /></td>
        </tr>

        <tr class="header-row">
          <th>@Html.LabelFor(m => m.UpperRollName)</th>
          <td colspan="@(limit)" class="header-data">@Html.DisplayFor(m => m.UpperRollName)</td>
        </tr>
        <tr class="header-row">
          <th>@Html.LabelFor(m => m.UpperActualDiameter)</th>
          <td colspan="@(limit)" class="header-data">@Html.DisplayFor(m => m.UpperActualDiameter)</td>
        </tr>
        <tr class="header-row">
          <th>@Html.LabelFor(m => m.BottomRollName)</th>
          <td colspan="@(limit)" class="header-data">@Html.DisplayFor(m => m.BottomRollName)</td>
        </tr>
        <tr class="header-row">
          <th>@Html.LabelFor(m => m.BottomActualDiameter)</th>
          <td colspan="@(limit)" class="header-data">@Html.DisplayFor(m => m.BottomActualDiameter)</td>
        </tr>

        <tr>
          <th class="section">@VM_Resources.PAGE_TITLE_Limit_Index</th>
          <td colspan="@(limit)"><hr /></td>
        </tr>

        <tr>
          <th>@Html.LabelFor(m => m.AccWeightLimitLabel)</th>
          <td></td>
          @{
            foreach (PE.HMIWWW.ViewModel.Module.VM_GroovesRoll rollUpper in Model.GrooveActualRollUpper)
            {
              <td align="center" class="h_dotted_right_ln">@Html.DisplayFor(m => rollUpper.AccWeightLimit)</td>
            }
          }
          <td></td>
        </tr>
        <tr>
          <th>@Html.LabelFor(m => m.AccBilletCntLimitLabel)</th>
          <td></td>
          @{
            foreach (PE.HMIWWW.ViewModel.Module.VM_GroovesRoll rollUpper in Model.GrooveActualRollUpper)
            {
              <td align="center" class="h_dotted_right_ln">@Html.DisplayFor(m => rollUpper.AccBilletCntLimit)</td>
            }
          }
          <td></td>
        </tr>

        <tr>
          <th>@Html.LabelFor(m => m.AccWeightLabel)</th>
          <td></td>
          @for (int x = 0; x < Model.GrooveActualRollUpper.Count; x++)
          {
            int k = x;
            <td align="center" class="h_dotted_right_ln">
              @(Html.PeKendo().NumericTextBoxFor(m => m.GrooveActualRollUpper[k].AccWeight).Enable(true)
            .HtmlAttributes(new { style = "width:100px; background-color: " + (Model.GrooveActualRollUpper[k].AccWeight > Model.GrooveActualRollUpper[k].AccWeightLimit ? "lightpink" : "white"), data_limit = Model.GrooveActualRollUpper[k].AccWeightLimit })
            .Events(ev => ev.Change("onLimitValueChange").Spin("onLimitValueChange")))
              @Html.ValidationMessageFor(m => m.GrooveActualRollUpper[k].AccWeight)
            </td>
          }
          <td></td>
        </tr>
        <tr>
          <th>@Html.LabelFor(m => m.AccWeightWithCoeffLabel)</th>
          <td></td>
          @for (int k = 0; k < Model.GrooveActualRollUpper.Count; k++)
          {
            <td align="center" class="h_dotted_right_ln">
              @(Html.PeKendo().NumericTextBoxFor(m => m.GrooveActualRollUpper[k].AccWeightWithCoeff).Enable(true)
            .HtmlAttributes(new { style = "width:100px; background-color: "
            + (Model.GrooveActualRollUpper[k].AccWeightWithCoeff > Model.GrooveActualRollUpper[k].AccWeightLimit ? "lightpink" : "white"),
            data_limit = Model.GrooveActualRollUpper[k].AccWeightLimit })
            .Events(ev => ev.Change("onLimitValueChange").Spin("onLimitValueChange")))
              @Html.ValidationMessageFor(m => m.GrooveActualRollUpper[k].AccWeightWithCoeff)
            </td>
          }
        </tr>
        <tr>
          <th>@Html.LabelFor(m => m.AccBilletCntLabel)</th>
          <td></td>
          @for (int k = 0; k < Model.GrooveActualRollUpper.Count; k++)
          {
            <td align="center" class="h_dotted_right_ln">
              @(Html.PeKendo().NumericTextBoxFor(m => m.GrooveActualRollUpper[k].AccBilletCnt).Enable(true)
            .HtmlAttributes(new { style = "width:100px; background-color: "
            + (Model.GrooveActualRollUpper[k].AccBilletCnt > Model.GrooveActualRollUpper[k].AccBilletCntLimit ? "lightpink" : "white"),
            data_limit = Model.GrooveActualRollUpper[k].AccBilletCntLimit })
            .Events(ev => ev.Change("onLimitValueChange").Spin("onLimitValueChange")).Format("#"))
              @Html.ValidationMessageFor(m => m.GrooveActualRollUpper[k].AccBilletCnt)
            </td>
          }
          <td></td>
        </tr>

        <tr>
          <th><hr /></th>
          <td colspan="@(limit)"><hr /></td>
        </tr>

        @* ROLL END *@
        <tr>
          <th style="height:150px;"></th>
          <td align="center"><img class="scale" src="~/css/System/img/roll-profille-left.png"></td>
          @{
            int grooveNumber = 1;
            string grooveNumberStr = "";
            foreach (PE.HMIWWW.ViewModel.Module.VM_GroovesRoll rollUpper in Model.GrooveActualRollUpper.OrderBy(z => z.GrooveNumber))
            {

              if (grooveNumber < 10)
              {
                grooveNumberStr = "0" + grooveNumber.ToString();
              }
              else
              {
                grooveNumberStr = grooveNumber.ToString();
              }

              if (rollUpper.GrooveShortName == "Flat")
              {
                if (rollUpper.EnumGrooveSetting == 1)
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-full-1.png"></td>
                }
                else if (rollUpper.EnumGrooveSetting == 2)
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-full-2.png"></td>
                }
                else if (rollUpper.EnumGrooveSetting == 3)
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-full-3.png"></td>
                }
                else
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-full.png"></td>
                }
              }
              else
              {
                if (rollUpper.EnumGrooveSetting == 1)
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-rd60-1.png"></td>
                }
                else if (rollUpper.EnumGrooveSetting == 2)
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-rd60-2.png"></td>
                }
                else if (rollUpper.EnumGrooveSetting == 3)
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-rd60-3.png"></td>
                }
                else
                {
                  <td align="center" class="roll"><div class="number">@grooveNumberStr</div><img class="scale" src="~/css/System/img/roll-profille-rd60.png"></td>
                }
              }
              grooveNumber++;
            }
          }
          <td align="center"><img class="scale" src="~/css/System/img/roll-profille-right.png"></td>
        </tr>
        <tr>
          <th>@Html.LabelFor(m => m.GrooveTemplateName)</th>
          <td></td>
          @{
            foreach (PE.HMIWWW.ViewModel.Module.VM_GroovesRoll rollUpper in Model.GrooveActualRollUpper)
            {
              <td align="center" class="h_dotted_right_ln">@Html.DisplayFor(m => rollUpper.GrooveTemplateName)</td>
            }
          }
          <td></td>
        </tr>
        <tr>
          <th><label>@VM_Resources.NAME_ActiveGrooves</label></th>
          <td></td>
          @for (int l = 0; l < Model.GrooveActualRollUpper.Count; l++)
          {
            int k = l;
            <td align="center" class="h_dotted_right_ln">
              @if (Model.GrooveActualRollUpper[k].EnumRollGrooveStatus == RollGrooveStatus.NotAvailable.Value)
              {
                @Html.CheckBoxFor(Model => Model.GrooveActualRollUpper[k].GrooveConfirmed, new { @disabled = "disable" })
              }
              else
              {
                @Html.CheckBoxFor(Model => Model.GrooveActualRollUpper[k].GrooveConfirmed)
              }
              @Html.ValidationMessageFor(m => m.GrooveActualRollUpper[k].GrooveConfirmed)
            </td>
          }
        </tr>

        <tr>
          <th><label>@VM_Resources.NAME_Remark</label></th>
          <td></td>
          @{
            int c;
            for (c = 0; c < Model.GrooveActualRollUpper.Count; c++)
            {
              <td align="center" class="h_dotted_right_ln">
                @Html.Kendo().TextBoxFor(m => m.GrooveActualRollUpper[c].GrooveRemark).Enable(true).HtmlAttributes(new { style = "width:100px" })
                @Html.ValidationMessageFor(m => m.GrooveActualRollUpper[c].GrooveRemark)
              </td>
            }
          }
        </tr>

        <tr>
          <th class="last-desc"><label>@VM_Resources.NAME_GrooveCondition</label></th>
          <td></td>
          @{
            int d;
            for (d = 0; d < Model.GrooveActualRollUpper.Count; d++)
            {
              <td align="center" class="h_dotted_right_ln" width="100px">
                @(Html.Kendo().DropDownListFor(x => x.GrooveActualRollUpper[d].EnumGrooveCondition).BindTo((SelectList)ViewBag.GrooveConditionSelectList).HtmlAttributes(new { @class = "form-control form-control-sm" }).HtmlAttributes(new { style = "width:100px" }))
              </td>
            }
          }
        </tr>

        <tr style="height:2vh"></tr>
      </tbody>
    </table>
  </div>

  <hr />
  <div class="row form-group">
    <div class="col invalid">
      <p id="error">
        <span class="k-icon k-i-close-circle error-icon"></span> @VM_Resources.GLOB_Error
      </p>
    </div>
    <div class="col text-right">
      <input type="submit" class="btn btn-primary popup_button" value="@PE.HMIWWW.Core.Resources.VM_Resources.GLOB_Form_Button_Save" />
    </div>
  </div>
</form>

<script>
  $(function () {
    $("#form").kendoValidator().data("kendoValidator");
  });
</script>
