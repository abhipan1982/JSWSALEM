<script type="text/javascript">
  function onDataBound() {
      var grid = this;
      grid.tbody.find('>tr').each(function () {
          var dataItem = grid.dataItem(this);
          if (dataItem.CommStatusError) {
              $(this).addClass('bg-danger text-light');
          }
      })
  }
</script>


@(
    Html.Kendo().Grid<PE.HMIWWW.ViewModel.System.VM_L3L2WorkOrderDefinition>()
        .Name("L3TransferTableWorkOrder")
        .NoRecords(x => x.Template(VM_Resources.GLOB_GRID_NO_DATA))
        .Scrollable()
        .Sortable()
        .Filterable()
        .Pageable(p => p
            .Messages(m => m.Display(VM_Resources.GLOB_pagination)))
        .HtmlAttributes(new { style = @String.Format("height:{0}px;", ((int)ViewBag.FullGridHeight) - 50) })
        .Columns(c =>
        {
          c.Bound(x => x.CounterId).Visible(false);
          c.Bound(x => x.CommMessage).Visible(false);
          c.Bound(x => x.ValidationCheck).Visible(false);
          c.ForeignKey(o => o.CommStatus, (SelectList)ViewBag.CommStatusList);
          c.Bound(x => x.CreatedTs).Filterable(f => f.UI(GridFilterUIRole.DateTimePicker)).Format(VM_Resources.ResourceManager.GetString("GLOB_LongDateTime_FORMAT")).HtmlAttributes(new { @class = "nowrap" });
          c.Bound(x => x.UpdatedTs).Filterable(f => f.UI(GridFilterUIRole.DateTimePicker)).Format(VM_Resources.ResourceManager.GetString("GLOB_LongDateTime_FORMAT")).HtmlAttributes(new { @class = "nowrap" });
          c.Bound(x => x.WorkOrderName);
          c.Bound(x => x.CustomerName);
          c.Bound(x => x.HeatName);
          c.Bound(x => x.SteelgradeCode);
          c.Bound(p => p.CommStatusEnum)
              .Filterable(false)
              .Sortable(x => x.AllowUnsort(false))
              .ClientTemplate(
                  "# if (CommStatusError) { #" +
                      Html.ImageButton("edit", "EditWorkOrderDefinitionPopup(#:CounterId#)") +
                      Html.ImageButton("delete", "DeleteWorkOrderDefinition(#=CounterId#)", false) +
                      Html.ImageButton("details", "ShowValidationDetails('#:ValidationCheck#', '#:CommMessage#')") +
                  "# } else { #" +
                      Html.ImageButton("details", "GoToWorkOrderDetails(#:CounterId#)") +
                  "# } #"
              )
              .Width(70)
              .Title(" ");
        })
        .Events(events => events.DataBound("onDataBound"))
        .DataSource(d => d
            .Ajax()
            .ServerOperation(true)
            .PageSize(((int)ViewBag.NoRecordsInGrid))
            .PageSize(26)
            .Read(r => r.Action("GetL3TransferTableWorkOrderList", "L3CommStatus"))
            )
)
